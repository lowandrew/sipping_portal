{% extends 'base.html' %}

{% block content %}
    <br>
    <h5>Active Run Details</h5>
    <div id="active-run-standalone">
        {% include 'sipper/active_run.html' %}
    </div>

    <br>

    <div class="alert alert-info" role="alert">
          <h5 class="alert-heading">Info</h5>
          <hr>
          <p class="mb-0">
              This page will show live console output generated by the GenesipprV2 process running in the background
              during an active run.
              There is no need to refresh the page - the contents will be updated automatically.
          </p>
    </div>

    {# Periodically refresh the status table #}
    <script type="text/javascript">
        function loadTables() {
            $(document).ready(function(){
                $('#active-run-standalone').load('active_run');
            });
        }

        //Immediately load the tables
        setTimeout(function() {
            {% for run in miseq_runs %}
                {% if run.genesippr_status == 'Processing' %}
                    console.log('Initial table loading');
                    loadTables();
                {% endif %}
            {% endfor %}
        }, 1);

        //Periodically load the tables if and job status == 'Processing'
        setInterval(function() {
            {% for run in miseq_runs %}
                {% if run.genesippr_status == 'Processing' %}
                    console.log('Loading...');
                    loadTables();
                {% endif %}
            {% endfor %}
        }, 5000); // This reloads the #active-run <div> every 5 seconds.
    </script>

{% endblock %}
